<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>用户中心</title>
    <link rel="stylesheet" href="/PSF/web/assets/layui/css/layui.css">
</head>
<body>

<div class="layui-main">

    <fieldset class="layui-elem-field layui-field-title" style="margin-top: 30px;">
        <legend>登录</legend>
    </fieldset>

    <form class="layui-form" action="" style="width:600px">
        <div class="layui-form-item">
            <label class="layui-form-label">用户名</label>
            <div class="layui-input-inline">
                <input type="text" id="username" lay-verify="title" autocomplete="off" placeholder="请输入用户名"
                       class="layui-input">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">密码</label>
            <div class="layui-input-inline">
                <input type="password" id="password" lay-verify="required" placeholder="请输入密码" autocomplete="off"
                       class="layui-input">
            </div>
        </div>
        <div class="layui-form-item">
            <div class="layui-input-block">
                <button class="layui-btn" lay-submit="" type="button" onclick="login()">登录</button>
            </div>
        </div>
    </form>

    <fieldset class="layui-elem-field layui-field-title">
        <legend>应用</legend>
    </fieldset>

    <div id="appDiv">


    </div>
</div>


<script type="text/javascript" src="/PSF/web/assets/jquery/jquery-2.2.4.min.js"></script>
<script type="text/javascript" src="/PSF/web/assets/layui/layui.all.js"></script>
<script type="text/javascript" src="/PSF/web/js/common.js"></script>
<script type="text/javascript">
    function login() {
        var data = {
            username: $("#username").val(),
            password: $("#password").val()
        };

        $.postJsonAjax("http://localhost:8900/organization/authenticate", data, function (response) {
            $.setToken(response.data);
            loadApp();
        });
    }

    function loadApp() {
        $.getAjax("http://localhost:8900/organization/app/find/all", function (data) {
            var html = '<div class="layui-row">';
            data.forEach(function (app) {
                html +=
                    '    <div class="layui-col-xs3">' +
                    '      <button onclick="redirectApp(\'' + app.id + '\')" class="layui-btn layui-btn-normal layui-btn-radius">' + app.appName + '</button>' +
                    '    </div>';
            });
            html += '  </div>';
            $("#appDiv").html(html);
        });
    }

    function redirectApp(appId) {
        $.getAjax("http://localhost:8900/organization/app/redirect?appId=" + appId, function (url) {
            console.log(url);
            window.open(url);
        })
    }

</script>

</body>
</html>